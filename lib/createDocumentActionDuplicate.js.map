{"version":3,"sources":["../src/createDocumentActionDuplicate.js"],"names":["client","sanityClient","withConfig","apiVersion","createDocumentActionDuplicate","documentSchemes","documentTypes","getReplacementFunctionsForAllSchemes","i18n","pluginConfig","language","DocumentActionDuplicate","type","published","draft","router","icon","CopyIcon","label","title","onHandle","currentDoc","_id","_createdAt","_updatedAt","currentContent","replacementFunctions","replacementData","Object","fromEntries","entries","map","fieldName","replacement","doc","created","create","navigateIntent","id","x","name","fields","filter","kaliberOptions","duplicate","field"],"mappings":"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","sourcesContent":["import sanityClient from 'part:@sanity/base/client'\nimport { CopyIcon } from '@sanity/icons'\nimport { i18n as getI18n } from './i18n'\nimport { useRouter } from '@sanity/base/router'\nimport pluginConfig from 'config:@kaliber/sanity-plugin-duplicate'\n\nconst client = sanityClient.withConfig({\n  apiVersion: '2022-04-06'\n})\n\nexport function createDocumentActionDuplicate(documentSchemes) {\n  const documentTypes = getReplacementFunctionsForAllSchemes(documentSchemes)\n  const i18n = getI18n(pluginConfig.language)\n\n  return function DocumentActionDuplicate({ type, published, draft }) {\n    const router = useRouter()\n    return {\n      icon: CopyIcon,\n      label: 'Duplicate',\n      title:  i18n['duplicate'],\n      onHandle: async () => {\n        const currentDoc = draft || published\n        if (!currentDoc) return\n\n        const { _id, _createdAt, _updatedAt, ...currentContent} = currentDoc\n        \n        const replacementFunctions = documentTypes?.[type]\n        const replacementData = Object.fromEntries(\n          Object.entries(replacementFunctions || [])\n          .map(([fieldName, replacement]) =>\n            [fieldName, typeof replacement === 'function' ? replacement(currentContent[fieldName]) : replacement]\n          )\n        )\n\n        const doc = { ...currentContent, ...replacementData, _id: 'drafts.' }\n        const created = await client.create(doc)\n        router.navigateIntent('edit', { id: created._id, type })\n      },\n    }\n  }\n\n}\n\nfunction getReplacementFunctionsForAllSchemes(documentSchemes) {\n  return Object.fromEntries(documentSchemes\n    .map(x => [x.name, Object.fromEntries(x.fields\n      .filter(x =>\n        typeof x.kaliberOptions?.duplicate === 'function'\n        || typeof x.kaliberOptions?.duplicate === 'string'\n        || typeof x.kaliberOptions?.duplicate === 'number'\n        || typeof x.kaliberOptions?.duplicate === 'boolean'\n        || typeof x.kaliberOptions?.duplicate === 'object'\n      )\n      .map(field => [field.name, field.kaliberOptions.duplicate]))\n    ])\n  )\n}\n"],"file":"createDocumentActionDuplicate.js"}