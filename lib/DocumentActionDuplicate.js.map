{"version":3,"sources":["../src/DocumentActionDuplicate.js"],"names":["client","sanityClient","withConfig","apiVersion","DocumentActionDuplicate","type","published","draft","router","i18n","pluginConfig","language","icon","CopyIcon","label","title","onHandle","currentDoc","_id","_createdAt","_updatedAt","currentContent","replacementFunctions","getReplacementFunctions","schema","get","replacementData","Object","fromEntries","entries","map","fieldName","replacement","doc","created","create","navigateIntent","id","fields","filter","x","undefined","includes","kaliberOptions","duplicate","field","name","getReplacementFunctionsForAllSchemes","documentSchemes"],"mappings":"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","sourcesContent":["import sanityClient from 'part:@sanity/base/client'\nimport { CopyIcon } from '@sanity/icons'\nimport { i18n as getI18n } from './i18n'\nimport { useRouter } from '@sanity/base/router'\nimport pluginConfig from 'config:@kaliber/sanity-plugin-duplicate'\nimport schema from 'part:@sanity/base/schema'\n\nconst client = sanityClient.withConfig({\n  apiVersion: '2022-04-06'\n})\n\nexport function DocumentActionDuplicate({ type, published, draft }) {\n  const router = useRouter()\n  const i18n = getI18n(pluginConfig.language)\n  return {\n    icon: CopyIcon,\n    label: 'Duplicate',\n    title: i18n['duplicate'],\n    onHandle: async () => {\n      const currentDoc = draft || published\n      if (!currentDoc) return\n      \n      const { _id, _createdAt, _updatedAt, ...currentContent } = currentDoc\n      const replacementFunctions = getReplacementFunctions(schema.get(type))\n      const replacementData = Object.fromEntries(\n        Object.entries(replacementFunctions || [])\n          .map(([fieldName, replacement]) =>\n            [fieldName, typeof replacement === 'function' ? replacement(currentContent[fieldName]) : replacement]\n          )\n      )\n\n      const doc = { ...currentContent, ...replacementData, _id: 'drafts.' }\n      const created = await client.create(doc)\n      router.navigateIntent('edit', { id: created._id, type })\n    },\n  }\n}\n\n\nfunction getReplacementFunctions(schema) {\n  return Object.fromEntries(schema.fields\n    .filter(x => ![undefined, null].includes(x.type.kaliberOptions?.duplicate))\n    .map(field => [field.name, field.type.kaliberOptions.duplicate]))\n  // return Object.fromEntries(schema.fields\n  //   .filter(x =>\n  //     typeof x.type.kaliberOptions?.duplicate === 'function'\n  //     || typeof x.type.kaliberOptions?.duplicate === 'string'\n  //     || typeof x.type.kaliberOptions?.duplicate === 'number'\n  //     || typeof x.type.kaliberOptions?.duplicate === 'boolean'\n  //     || typeof x.type.kaliberOptions?.duplicate === 'object'\n  //   )\n  //   .map(field => [field.name, field.type.kaliberOptions.duplicate]))\n}\n\nfunction getReplacementFunctionsForAllSchemes(documentSchemes) {\n  return Object.fromEntries(documentSchemes\n    .map(x => [x.name, Object.fromEntries(x.fields\n      .filter(x =>\n        typeof x.kaliberOptions?.duplicate === 'function'\n        || typeof x.kaliberOptions?.duplicate === 'string'\n        || typeof x.kaliberOptions?.duplicate === 'number'\n        || typeof x.kaliberOptions?.duplicate === 'boolean'\n        || typeof x.kaliberOptions?.duplicate === 'object'\n      )\n      .map(field => [field.name, field.kaliberOptions.duplicate]))\n    ])\n  )\n}\n"],"file":"DocumentActionDuplicate.js"}